% = Load packages ================================================================================

\RequirePackage{etoolbox}                   % convinient class definition commands
\RequirePackage{xparse}                     % convinient enviroment definition commands
%\RequirePackage{xspace}                     % convinient enviroment definition commands
\RequirePackage[T1]{fontenc}                % codifica dei font in uscita
\RequirePackage[utf8]{inputenc}             % codifica dei font in uscita
\RequirePackage[english,italian]{babel}     % lingua del documento\texttt{}
\RequirePackage{tocloft}					% add "......" dots to index
\RequirePackage{fancyhdr}                   % to get header/footer on each page
\RequirePackage{graphicx}                   % to include images
\RequirePackage{xr-hyper}                   % inter-document links
\RequirePackage{longtable}                  % table can be broken through different pages
\RequirePackage{caption}                    % better captions for table and figures
\RequirePackage{tabu}                       % support for better columns (problemi con text-wrapping)
\RequirePackage{tabularx}                   % risolve problem text-wrapping di tabu
\RequirePackage{booktabs}                   % support for better borders
\RequirePackage[table, dvipsnames]{xcolor}              % support for colourable rows (and extended color palette)
\RequirePackage[default]{gillius}           % set font gillius
%\RequirePackage{stringstrings}              % set font gillius
\RequirePackage{titlesec}
\RequirePackage{fancyvrb}                   % add pure code to document
\RequirePackage{nameref}                    % to ref-ers to sections name and not its number
\RequirePackage[official]{eurosym}          % per riprodurre il simbolo €
\RequirePackage[margin=3cm,headheight=14pt]{geometry} % change doc margin
\RequirePackage[bookmarks=true,hyperfootnotes=false,hidelinks,colorlinks=true, pdfnewwindow]{hyperref} % allow clickable index
\RequirePackage{ltablex}                    % necessario per \endhead su tabularx
\RequirePackage{enumitem}
\RequirePackage{tcolorbox}

\RequirePackage{listings}
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

\lstdefinelanguage{JavaScript}{
	keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
	keywordstyle=\color{blue}\bfseries,
	ndkeywords={class, export, boolean, throw, implements, import, this},
	ndkeywordstyle=\color{darkgray}\bfseries,
	identifierstyle=\color{black},
	sensitive=false,
	comment=[l]{//},
	morecomment=[s]{/*}{*/},
	commentstyle=\color{purple}\ttfamily,
	stringstyle=\color{red}\ttfamily,
	morestring=[b]',
	morestring=[b]"
}

\lstset{
	language=JavaScript,
	%backgroundcolor=\color{lightgray},
	extendedchars=true,
	basicstyle=\footnotesize\ttfamily,
	showstringspaces=false,
	showspaces=false,
	numbers=left,
	numberstyle=\footnotesize,
	numbersep=9pt,
	tabsize=2,
	breaklines=true,
	showtabs=false,
	captionpos=b
}


\DeclareOption{lettera}{
	\newcommand{\lettera}{lettera-mode}
}

\ProcessOptions\relax

% = Define group style ==========================================================================

	%-------------------INIZIO create subsubparagraph--------------------------------------
	\newcounter{subsubparagraph}[subparagraph]
	\def\toclevel@subsubparagraph{6}
	\renewcommand\thesubsubparagraph{%
		\thesubparagraph.\@arabic\c@subsubparagraph}
	\newcommand\subsubparagraph{%
		\@startsection{subsubparagraph}    % counter
		{6}                              % level
		{\parindent}                     % indent
		{3.25ex \@plus 1ex \@minus .2ex} % beforeskip
		{-1em}                           % afterskip
		{\normalfont\normalsize\bfseries}}
	\newcommand\l@subsubparagraph{\@dottedtocline{6}{13.5em}{5em}}
	\newcommand{\subsubparagraphmark}[1]{}
	\setcounter{tocdepth}{6}
	\setcounter{secnumdepth}{6} % aggiunge contatore ai paragrafi
	%-------------------FINE create subsubparagraph--------------------------------------

	%-------------------INIZIO utility --------------------------------------
	\newcommand{\cit}[1]{\textit{#1}}					% citazioni
	\newcommand{\abbr}[1]{\textit{#1}}					% abbreviazioni
    \newcommand{\frmdata}[3]{#3-#2-#1}					% format data
    \newcommand{\frmora}[2]{#1:#2}						% format ora
    
    \newcommand{\hicode}[1]{ \tcbox[size=fbox, on line]{\texttt{#1}}}
    %\newcommand{\gref}[1]{\subsubsection{#1}\label{#1}}				% create a referable glossary term
    %\newcommand{\glo}[1]{\textit{#1\textsubscript{G}}}	% create a referement to glossary term
	%\newcommand{\glo}[1]{\textit{\nameref{#1}\textsubscript{G}}}	% create a referement to glossary term

	\newcommand{\gref}[1]{\subsubsection{#1}\label{glo:#1}}
	\newcommand{\glo}[2]{\textit{\hyperref[glo:#1]{#2\textsubscript{G}}}}
	
	\newcommand{\mgref}[1]{\subsubsection*{#1}\label{glo:#1}}
	\newcommand{\mglo}[2]{\textit{\hyperref[glo:#1]{#2\textsubscript{G}}}}

	% \NewDocumentCommand{\zg}{o m}{\label{zg:\IfNoValueTF{#1}{#2}{#1}}#2}
	% \NewDocumentCommand{\zrg}{o m}{\hyperref[zg:\IfNoValueTF{#1}{#2}{#1}]{\textit{#2\ped{\small{G}}}}}

	%-------------------FINE glossary command--------------------------------------

% = Define abbr ==========================================================================

\newcommand{\logozephyrus}{../../../../Template/logo-zephyrus.pdf}
\newcommand{\logosimbolo}{../../../../Template/logo-simbolo.pdf}
\newcommand{\logotesto}{../../../../Template/logo-testo.pdf}

\newcommand{\mail}[1]{\href{mailto:#1}{\texttt{#1}}}

\newcommand{\zephyrus}{\textit{\getgroupName}}
\newcommand{\mailzep}{\mail{\getgroupMail}}
\newcommand{\riskapp}{\textit{\getcompanyName}}
\newcommand{\tullio}{professor Tullio Vardanega}
\newcommand{\cardin}{professor Riccardo Cardin}
\newcommand{\Tullio}{Professor Tullio Vardanega}
\newcommand{\Cardin}{Professor Riccardo Cardin}
\newcommand{\progetto}{\textit{\getprojectName}}

\newcommand{\jsv}{JavaScript ES6}
\newcommand{\js}{JavaScript}

\newcommand{\responsabile}{\textit{Responsabile}}
\newcommand{\responsabilediprogetto}{\textit{Responsabile di progetto}}
\newcommand{\amministratore}{\textit{Amministratore}}
\newcommand{\amministratori}{\textit{Amministratori}}
\newcommand{\analista}{\textit{Analista}}
\newcommand{\analisti}{\textit{Analisti}}
\newcommand{\progettista}{\textit{Progettista}}
\newcommand{\progettisti}{\textit{Progettisti}}
\newcommand{\programmatore}{\textit{Programmatore}}
\newcommand{\programmatori}{\textit{Programmatori}}
\newcommand{\verificatore}{\textit{Verificatore}}
\newcommand{\verificatori}{\textit{Verificatori}}

\newcommand{\pdp}{\textit{Piano di progetto}}
\newcommand{\pdq}{\textit{Piano di qualifica}}
\newcommand{\ndp}{\textit{Norme di progetto}}
\newcommand{\sdf}{\textit{Studio di fattibilità}}
\newcommand{\adr}{\textit{Analisi dei requisiti}}
\newcommand{\st}{\textit{Specifica tecnica}}
\newcommand{\ddp}{\textit{Definizione di prodotto}}
\newcommand{\man}{\textit{Manuale utente}}
\newcommand{\gl}{\textit{Glossario}}
\newcommand{\ldp}{\textit{Lettera di presentazione}}

%versione 1
\newcommand{\pdpvuno}{\textit{Piano di progetto v1.0.0}}
\newcommand{\pdqvuno}{\textit{Piano di qualifica v1.0.0}}
\newcommand{\ndpvuno}{\textit{Norme di progetto v1.0.0}}
\newcommand{\adrvuno}{\textit{Analisi dei requisiti v1.0.0}}
\newcommand{\glvuno}{\textit{Glossario v1.0.0}}
\newcommand{\stvuno}{\textit{Specifica tecnica v1.0.0}}
\newcommand{\ddpvuno}{\textit{Definizione di prodotto v1.0.0}}
%versione 2
\newcommand{\pdpvdue}{\textit{Piano di progetto v2.0.0}}
\newcommand{\pdqvdue}{\textit{Piano di qualifica v2.0.0}}
\newcommand{\ndpvdue}{\textit{Norme di progetto v2.0.0}}
\newcommand{\adrvdue}{\textit{Analisi dei requisiti v2.0.0}}
\newcommand{\glvdue}{\textit{Glossario v2.0.0}}
\newcommand{\stvdue}{\textit{Specifica tecnica v2.0.0}}
\newcommand{\ddpvdue}{\textit{Definizione di prodotto v2.0.0}}
%versione 3
\newcommand{\pdpvtre}{\textit{Piano di progetto v3.0.0}}
\newcommand{\pdqvtre}{\textit{Piano di qualifica v3.0.0}}
\newcommand{\ndpvtre}{\textit{Norme di progetto v3.0.0}}
\newcommand{\adrvtre}{\textit{Analisi dei requisiti v3.0.0}}
\newcommand{\glvtre}{\textit{Glossario v3.0.0}}
\newcommand{\stvtre}{\textit{Specifica tecnica v3.0.0}}
\newcommand{\ddpvtre}{\textit{Definizione di prodotto v3.0.0}}

\newcommand{\pdpv}{\textit{Piano di progetto v3.0.0}}
\newcommand{\pdqv}{\textit{Piano di qualifica v3.0.0}}
\newcommand{\ndpv}{\textit{Norme di progetto v3.0.0}}
\newcommand{\sdfv}{\textit{Studio di fattibilità v1.0.0}}
\newcommand{\adrv}{\textit{Analisi dei requisiti v3.0.0}}
\newcommand{\stv}{\textit{Specifica tecnica v2.0.0}}
\newcommand{\ddpv}{\textit{Definizione di prodotto v1.0.0}}
\newcommand{\manv}{\textit{Manuale utente v1.0.0}}
\newcommand{\glv}{\textit{Glossario v2.0.0}}
\newcommand{\vunoi}{\textit{VerbaleInterno\_1\_20161202}}
\newcommand{\vduei}{\textit{VerbaleInterno\_2\_20161220}}
\newcommand{\vtrei}{\textit{VerbaleInterno\_3\_20161227}}
\newcommand{\vquattroi}{\textit{VerbaleInterno\_4\_20170103}}
\newcommand{\vcinquei}{\textit{VerbaleInterno\_5\_201700206}}
\newcommand{\vseii}{\textit{VerbaleInterno\_6\_20170221}}
\newcommand{\vsesettei}{\textit{VerbaleInterno\_7\_20170315}}
\newcommand{\vottoi}{\textit{VerbaleInterno\_8\_20170406}}
\newcommand{\vunoe}{\textit{VerbaleEsterno\_1\_20161203}}
\newcommand{\vduee}{\textit{VerbaleEsterno\_2\_20161227}}
\newcommand{\vtree}{\textit{VerbaleEsterno\_3\_20170209}}
\newcommand{\revereq}{\textbf{Revisione dei requisiti}}
\newcommand{\revacc}{\textbf{Revisione di accettazione}}
\newcommand{\revaqual}{\textbf{Revisione di qualifica}}
\newcommand{\revprog}{\textbf{Revisione di progettazione}}

\newcommand{\introScopo}
{
	Lo scopo del prodotto consiste nella creazione di un'interfaccia web contenente una mappa geografica su cui potranno essere rappresentati:
	\begin{itemize}
		\item il processo produttivo aziendale;
		\item gli scenari di danno;
		\item i risultati dell'analisi dei rischi.
	\end{itemize}
	Il prodotto verrà utilizzato da agenti assicuratori per l'inserimento delle informazioni utili allo svolgimento dell'analisi dei rischi dell'assicurando.\\
	L'interfaccia dovrà essere in grado di connettersi ai sistemi preesistenti di \riskapp{} per la memorizzazione e gestione dei dati inseriti. A causa del requisito di integrabilità, che è stato deciso di soddisfare, l'applicazione da sviluppare sarà parte integrante dell'attuale applicazione del proponente.
}

\newcommand{\introGlossario}
{
	Allo scopo di rendere più semplice e chiara la comprensione dei documenti
	viene allegato il \glv, nel quale verranno raccolte le spiegazioni di
	terminologia tecnica o ambigua, abbreviazioni ed acronimi. Per evidenziare
	un termine presente in tale documento, esso verrà marcato con il pedice \textit{\textsubscript{G}}.
	Solo la prima occorrenza del termine in ogni sezione sarà marcata per non appesantire la lettura del documento.\\
    Tutti i termini del glossario evidenziati sono link ipertestuali al glossario stesso; affinché funzionino correttamente è necessario che la posizione delle directory e dei file forniti non venga alterata.\\
}

\newcounter{decV}
\newcommand{\itemVI}{\stepcounter{decV}\item \textbf{VI\_\getdocVerbV{}.\arabic{decV}} - }
\newcommand{\itemVE}{\stepcounter{decV}\item \textbf{VE\_\getdocVerbV{}.\arabic{decV}} - }

% = Define doc variables ==========================================================================

\newrobustcmd\NewVar[1]{ % Define \NewVar to obtain document information
	\ifcsundef{#1}
	{
		\csdef{#1}##1{\csdef{@#1}{##1}}
		\csdef{get#1}{\csuse{@#1}}
	}
}

% document information variable
\NewVar{groupName}{}
\NewVar{groupMail}{}
\NewVar{companyName}{}
\NewVar{projectName}{}

\groupName{Zephyrus}
\groupMail{zephyrus.swe@gmail.com}
\companyName{RiskApp}
\projectName{DeGeOP}

\NewVar{docTitle}{}
\NewVar{docVerbV}{}
\NewVar{docVersion}{}
\NewVar{docCreationDate}{}
\NewVar{docLastUpdateDate}{}
\NewVar{docStatus}{}
\NewVar{docEditors}{}
\NewVar{docVerificators}{}
\NewVar{docApprovers}{}
\NewVar{docUse}{}
\NewVar{docDestination}{}
\NewVar{docJournal}{}

\definecolor{I}{HTML}{0172CE} %old:0076FF %CornflowerBlue!50
\definecolor{P}{HTML}{FFFFFF}
\definecolor{D}{HTML}{CCE6FF}

% = Every Doc Preamble ===================================================================================

\setlength{\parindent}{0pt} % remove paragraph indentation
\setcounter{secnumdepth}{5} % to block out subsubparagraph from showing out with its numbering (index etc.)
\setcounter{tocdepth}{5}
\renewcommand{\footrulewidth}{0.4pt} % to create \hline at the bottom in the footer

\let\oldsection\section 						% clearpage for every new section
\renewcommand\section{\clearpage\oldsection}	% clearpage for every new section

\AtBeginDocument{
	\sloppy
	\ifcsdef{lettera}{\relax}{
		\pagestyle{fancy} % to let fancyhdr work
		\lhead{\slshape\nouppercase{\rightmark}}
		\chead{}
		\rhead{\getdocTitle}
		%\lfoot{\getgroupName{ - }\getprojectName}
		\lfoot{\raisebox{-.3\height}{\includegraphics[keepaspectratio=true, width=0.5cm]{\logosimbolo}}{ }\getgroupName{ - }\getprojectName}
		\cfoot{}
		\rfoot{\hypersetup{linkcolor=black}\thepage\ di \pageref{\getdocTitle:LastPreamblePage}}
		\addtocontents{toc}{\protect\thispagestyle{fancy}}

		\hypersetup{pageanchor=false,linkcolor=black}
		\begin{titlepage}
			\begin{center}
				\begin{large} \textbf{\getcompanyName} \end{large}

				\vspace{0.2em}
				\hrule
				\vspace{0.7em}

				\begin{large} \textbf{\getprojectName} \end{large}

				\vspace{14em}

				\includegraphics[keepaspectratio=true, width=14cm]{\logozephyrus}

				\vspace{1.5em}
				\vfill % Le informazioni del documento sono ancorate a fine pagina

				\begin{Huge} \getdocTitle \end{Huge}

				\vspace{5em}
				\begin{Large} \textbf{Informazioni sul documento} \end{Large}
				\vspace{1em}

				\begin{large}
					\begin{tabu}{r|l}
						\textbf{Versione}	& \getdocVersion \\
						\textbf{Data di Creazione} & \getdocCreationDate \\
						\textbf{Data ultima modifica} & \getdocLastUpdateDate \\
						\textbf{Stato} & \getdocStatus \\
						\textbf{Redazione}	& \getdocEditors \\
						\textbf{Verifica}	& \getdocVerificators \\
						\textbf{Approvazione}	& \getdocApprovers \\
						\textbf{Uso} & \getdocUse \\
						\textbf{Lista di distribuzione}	& \getdocDestination \\
						\textbf{Email di riferimento} & \getgroupMail \\
					\end{tabu}
				\end{large}
				\normalsize
			\end{center}
		\end{titlepage}
		\hypersetup{pageanchor=true}

		\newpage

		\pagenumbering{Roman}

		\begin{center}
			\Large{\textbf{Registro delle modifiche}}
			\vspace{0.5em}
			\normalsize
			\renewcommand{\arraystretch}{1.5}
			\rowcolors{2}{gray!30}{white}
			\begin{tabularx}{\textwidth}{l l l l X}
				\rowcolor{gray!70}\textbf{Versione} & \textbf{Data} & \textbf{Autore} & \textbf{Ruolo} & \textbf{Descrizione} \\
				\toprule
				\endhead
				\getdocJournal
				\bottomrule
			\end{tabularx}
		\end{center}

		\newpage

		\tableofcontents
		\label{\getdocTitle:LastPreamblePage}

		\hypersetup{linkcolor=blue,urlcolor=blue}
		\newpage

		\pagenumbering{arabic}
		\rfoot{\hypersetup{linkcolor=black}\thepage\ di \pageref{\getdocTitle:LastPage}}
		\setcounter{table}{0}
	}
}

\AtEndDocument {
	\label{\getdocTitle:LastPage}
}

% = End of File ====================================================================================

\titleformat{\paragraph}{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\titleformat{\subparagraph}{\normalfont\normalsize\bfseries}{\thesubparagraph}{1em}{}
\titlespacing*{\subparagraph}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}


%includi glossario 

\iftrue
  \newcommand{\includeGlossario}{\externaldocument{../../Esterni/Glossario/Glossario}}
\else
  \newcommand{\includeGlossario}{\externaldocument{../Esterni/Glossario}}
\fi






\endinput %every class file needs this at the end

% ==========================================================
% ------------------------ various shit --------------------
% ==========================================================

% ------------------------ glossary links
% \NewDocumentCommand{\zg}{o m}{\label{zg:\IfNoValueTF{#1}{#2}{#1}}#2}
% \NewDocumentCommand{\zrg}{o m}{\hyperref[zg:\IfNoValueTF{#1}{#2}{#1}]{\textit{#2\ped{\small{G}}}}}

% ------------------------ coloured links
%\NewDocumentCommand{\zhref}{O{blue} m m}{\href{#2}{\color{#1}{#3}}}
%\NewDocumentCommand{\zref}{O{blue} m}{\textcolor{#1}{\ref{#2}}}
%\NewDocumentCommand{\zrefname}{O{blue} m}{\textcolor{#1}{\nameref{#2}}}
